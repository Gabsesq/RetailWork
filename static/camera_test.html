<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .camera-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .camera-button {
            padding: 12px 24px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .camera-button:hover {
            background-color: #1976D2;
        }

        .camera-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .camera-button.danger {
            background-color: #f44336;
        }

        .camera-button.danger:hover {
            background-color: #d32f2f;
        }

        .camera-button.success {
            background-color: #4CAF50;
        }

        .camera-button.success:hover {
            background-color: #45a049;
        }

        #camera {
            width: 100%;
            max-width: 500px;
            height: 375px;
            background-color: #000;
            border-radius: 8px;
            margin: 15px 0;
            display: block;
        }

        #canvas {
            display: none;
        }

        .captured-images {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }

        .captured-image {
            position: relative;
            border: 3px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .captured-image img {
            width: 200px;
            height: 150px;
            object-fit: cover;
        }

        .remove-image {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: rgba(255, 0, 0, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .camera-status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
        }

        .camera-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .camera-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .camera-status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .info-box {
            background-color: #e3f2fd;
            border: 1px solid #2196F3;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }

        .info-box h3 {
            margin-top: 0;
            color: #1976D2;
        }

        .info-box ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .info-box li {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .camera-controls {
                flex-direction: column;
            }
            
            .camera-button {
                width: 100%;
            }
            
            #camera {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ Camera Functionality Test</h1>
        
        <div class="info-box">
            <h3>How to Test:</h3>
            <ul>
                <li><strong>Desktop:</strong> Use your webcam or external camera</li>
                <li><strong>Mobile:</strong> Use your phone's camera (preferably back camera)</li>
                <li><strong>Permission:</strong> Allow camera access when prompted</li>
                <li><strong>HTTPS:</strong> Camera works best over HTTPS (required for production)</li>
            </ul>
        </div>

        <div class="camera-section">
            <h3>üì∑ Camera Controls</h3>
            <div id="cameraStatus" class="camera-status info">
                Click "Start Camera" to begin testing
            </div>
            
            <div class="camera-controls">
                <button id="startCameraBtn" class="camera-button">üì∑ Start Camera</button>
                <button id="captureBtn" class="camera-button" disabled>üì∏ Take Photo</button>
                <button id="stopCameraBtn" class="camera-button danger" disabled>‚èπÔ∏è Stop Camera</button>
                <button id="clearPhotosBtn" class="camera-button success" disabled>üóëÔ∏è Clear All Photos</button>
            </div>
            
            <video id="camera" autoplay muted></video>
            <canvas id="canvas"></canvas>
            
            <h4>üì∏ Captured Photos:</h4>
            <div class="captured-images" id="capturedImages">
                <!-- Captured images will appear here -->
            </div>
        </div>

        <div class="info-box">
            <h3>‚úÖ Test Results:</h3>
            <ul>
                <li><strong>Camera Access:</strong> <span id="cameraAccess">Not tested</span></li>
                <li><strong>Photo Capture:</strong> <span id="photoCapture">Not tested</span></li>
                <li><strong>Image Quality:</strong> <span id="imageQuality">Not tested</span></li>
                <li><strong>Mobile Compatibility:</strong> <span id="mobileCompat">Not tested</span></li>
            </ul>
        </div>
    </div>

    <script>
        let stream = null;
        let capturedImages = [];

        // Camera functions
        async function startCamera() {
            try {
                updateStatus('Starting camera...', 'info');
                updateTestResult('cameraAccess', 'Testing...');
                
                // Try to use back camera on mobile devices
                const constraints = {
                    video: {
                        facingMode: 'environment', // Use back camera
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('camera');
                video.srcObject = stream;
                
                updateStatus('Camera started successfully! Click "Take Photo" to capture images.', 'success');
                updateTestResult('cameraAccess', '‚úÖ Working');
                updateTestResult('mobileCompat', navigator.userAgent.includes('Mobile') ? '‚úÖ Mobile detected' : '‚úÖ Desktop detected');
                
                document.getElementById('startCameraBtn').disabled = true;
                document.getElementById('captureBtn').disabled = false;
                document.getElementById('stopCameraBtn').disabled = false;
                
            } catch (err) {
                console.error('Camera error:', err);
                updateStatus('Camera access denied. Please allow camera permissions and try again.', 'error');
                updateTestResult('cameraAccess', '‚ùå Failed - ' + err.message);
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                
                const video = document.getElementById('camera');
                video.srcObject = null;
                
                updateStatus('Camera stopped. Click "Start Camera" to begin again.', 'info');
                document.getElementById('startCameraBtn').disabled = false;
                document.getElementById('captureBtn').disabled = true;
                document.getElementById('stopCameraBtn').disabled = true;
            }
        }

        function captureImage() {
            const video = document.getElementById('camera');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            
            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame to canvas
            context.drawImage(video, 0, 0);
            
            // Convert to base64
            const imageData = canvas.toDataURL('image/jpeg', 0.8);
            
            // Add to captured images array
            capturedImages.push(imageData);
            
            // Display the captured image
            displayCapturedImage(imageData, capturedImages.length - 1);
            
            updateStatus(`Photo captured! (${capturedImages.length} total)`, 'success');
            updateTestResult('photoCapture', `‚úÖ ${capturedImages.length} photos taken`);
            updateTestResult('imageQuality', `‚úÖ ${canvas.width}x${canvas.height} resolution`);
            
            document.getElementById('clearPhotosBtn').disabled = false;
        }

        function displayCapturedImage(imageData, index) {
            const container = document.getElementById('capturedImages');
            
            const imageDiv = document.createElement('div');
            imageDiv.className = 'captured-image';
            
            const img = document.createElement('img');
            img.src = imageData;
            img.alt = `Captured image ${index + 1}`;
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-image';
            removeBtn.innerHTML = '√ó';
            removeBtn.onclick = () => removeImage(index);
            
            imageDiv.appendChild(img);
            imageDiv.appendChild(removeBtn);
            container.appendChild(imageDiv);
        }

        function removeImage(index) {
            capturedImages.splice(index, 1);
            refreshCapturedImages();
            updateStatus(`Photo removed. (${capturedImages.length} remaining)`, 'info');
            updateTestResult('photoCapture', capturedImages.length > 0 ? `‚úÖ ${capturedImages.length} photos remaining` : 'Not tested');
            
            if (capturedImages.length === 0) {
                document.getElementById('clearPhotosBtn').disabled = true;
            }
        }

        function clearAllPhotos() {
            capturedImages = [];
            document.getElementById('capturedImages').innerHTML = '';
            updateStatus('All photos cleared.', 'info');
            updateTestResult('photoCapture', 'Not tested');
            document.getElementById('clearPhotosBtn').disabled = true;
        }

        function refreshCapturedImages() {
            const container = document.getElementById('capturedImages');
            container.innerHTML = '';
            
            capturedImages.forEach((imageData, index) => {
                displayCapturedImage(imageData, index);
            });
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('cameraStatus');
            statusDiv.textContent = message;
            statusDiv.className = `camera-status ${type}`;
        }

        function updateTestResult(elementId, result) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = result;
            }
        }

        // Event listeners
        document.getElementById('startCameraBtn').addEventListener('click', startCamera);
        document.getElementById('stopCameraBtn').addEventListener('click', stopCamera);
        document.getElementById('captureBtn').addEventListener('click', captureImage);
        document.getElementById('clearPhotosBtn').addEventListener('click', clearAllPhotos);

        // Clean up camera when page is unloaded
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stopCamera();
            }
        });

        // Check if we're on HTTPS
        if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
            updateStatus('‚ö†Ô∏è Camera requires HTTPS for security. Some features may not work.', 'error');
        }
    </script>
</body>
</html> 